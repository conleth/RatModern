{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{z}from\"zod\";import{SPVS_CATEGORIES,SPVS_SUBCATEGORIES,spvsMetadata,getSpvsRequirements}from\"../lib/spvsData.js\";import{SPVS_QUESTIONNAIRE_QUESTIONS,generateSpvsRecommendations}from\"../lib/spvsQuestionnaireData.js\";import{spvsQuestionnaireStore}from\"../lib/spvsQuestionnaireStore.js\";const saveSchema=z.object({userId:z.string().min(1),answers:z.record(z.boolean())});const requirementQuerySchema=z.object({search:z.string().optional(),levels:z.string().optional(),categories:z.string().optional()});function parseLevelFilter(value){if(!value){return void 0}const levels=value.split(\",\").map(level=>level.trim().toUpperCase()).filter(Boolean);const validLevels=[\"L1\",\"L2\",\"L3\"];return levels.filter(level=>validLevels.includes(level))}__name(parseLevelFilter,\"parseLevelFilter\");function parseListFilter(value){if(!value){return void 0}const entries=value.split(\",\").map(entry=>entry.trim().toUpperCase()).filter(Boolean);return entries.length?Array.from(new Set(entries)):void 0}__name(parseListFilter,\"parseListFilter\");function registerSpvsRoutes(app){app.get(\"/spvs/questionnaire/questions\",async()=>({questions:SPVS_QUESTIONNAIRE_QUESTIONS}));app.get(\"/spvs/questionnaire\",async(request,reply)=>{const userId=request.query?.userId;if(!userId){return reply.badRequest(\"Missing userId query parameter.\")}const record=spvsQuestionnaireStore.get(userId);if(!record){return reply.notFound(\"No SPVS questionnaire data found for the supplied user.\")}return record});app.post(\"/spvs/questionnaire\",async(request,reply)=>{const parseResult=saveSchema.safeParse(request.body);if(!parseResult.success){return reply.badRequest(\"Invalid SPVS questionnaire payload.\")}const{userId,answers}=parseResult.data;const recommendations=generateSpvsRecommendations(answers);const record=spvsQuestionnaireStore.save({userId,answers,recommendations,createdAt:\"\",updatedAt:\"\"});return record});app.put(\"/spvs/questionnaire\",async(request,reply)=>{const parseResult=saveSchema.safeParse(request.body);if(!parseResult.success){return reply.badRequest(\"Invalid SPVS questionnaire payload.\")}const{userId,answers}=parseResult.data;const recommendations=generateSpvsRecommendations(answers);const record=spvsQuestionnaireStore.save({userId,answers,recommendations,createdAt:\"\",updatedAt:\"\"});return record});app.get(\"/spvs/taxonomy\",async()=>({metadata:spvsMetadata,categories:SPVS_CATEGORIES,subcategories:SPVS_SUBCATEGORIES}));app.get(\"/spvs/requirements\",async request=>{const parseResult=requirementQuerySchema.safeParse(request.query);if(!parseResult.success){return{metadata:{...spvsMetadata,filters:{},resultCount:0},requirements:[]}}const{search,levels,categories}=parseResult.data;const levelFilters=parseLevelFilter(levels);const categoryFilters=parseListFilter(categories);const requirements=getSpvsRequirements({search,levels:levelFilters,categories:categoryFilters});return{metadata:{...spvsMetadata,filters:{search:search??null,levels:levelFilters??[],categories:categoryFilters??[]},resultCount:requirements.length},requirements}})}__name(registerSpvsRoutes,\"registerSpvsRoutes\");export{registerSpvsRoutes};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/ck/OwaspRatRemake/backend/src/routes/spvs.ts"],"sourcesContent":[null]}}