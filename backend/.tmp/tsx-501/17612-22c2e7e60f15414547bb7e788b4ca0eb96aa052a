{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{z}from\"zod\";import{getTicketingAdapter}from\"../ticketing/index.js\";const linkSchema=z.object({taskId:z.string(),workItemId:z.string(),role:z.enum([\"architect\",\"developer\",\"tester\",\"business-analyst\",\"executive\"]).optional(),metadata:z.record(z.any()).optional()});function registerTicketingRoutes(app){app.post(\"/ticketing/rally/link\",async(request,reply)=>{const parseResult=linkSchema.safeParse(request.body);if(!parseResult.success){return reply.badRequest(\"Invalid link payload\")}const authorization=request.headers.authorization;if(!authorization?.startsWith(\"Bearer \")){return reply.unauthorized(\"Missing Rally access token\")}const accessToken=authorization.replace(\"Bearer \",\"\");const adapter=getTicketingAdapter(\"rally\");const context={accessToken,userRole:parseResult.data.role??\"developer\"};try{await adapter.linkTask(parseResult.data,context);return reply.status(204).send()}catch(error){request.log.error({err:error},\"Failed to link Rally work item\");return reply.internalServerError(\"Failed to link Rally work item\")}})}__name(registerTicketingRoutes,\"registerTicketingRoutes\");export{registerTicketingRoutes};\n","warnings":[],"map":{"version":3,"mappings":"kHACA,OAAS,MAAS,MAElB,OAAS,wBAA2B,wBAGpC,MAAM,WAAa,EAAE,OAAO,CAC1B,OAAQ,EAAE,OAAO,EACjB,WAAY,EAAE,OAAO,EACrB,KAAM,EACH,KAAK,CACJ,YACA,YACA,SACA,mBACA,WACF,CAAC,EACA,SAAS,EACZ,SAAU,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,SAAS,CACvC,CAAC,EAEM,SAAS,wBAAwB,IAAsB,CAC5D,IAAI,KAAK,wBAAyB,MAAO,QAAS,QAAU,CAC1D,MAAM,YAAc,WAAW,UAAU,QAAQ,IAAI,EAErD,GAAI,CAAC,YAAY,QAAS,CACxB,OAAO,MAAM,WAAW,sBAAsB,CAChD,CAEA,MAAM,cAAgB,QAAQ,QAAQ,cACtC,GAAI,CAAC,eAAe,WAAW,SAAS,EAAG,CACzC,OAAO,MAAM,aAAa,4BAA4B,CACxD,CAEA,MAAM,YAAc,cAAc,QAAQ,UAAW,EAAE,EAEvD,MAAM,QAAU,oBAAoB,OAAO,EAE3C,MAAM,QAA4B,CAChC,YACA,SAAU,YAAY,KAAK,MAAQ,WACrC,EAEA,GAAI,CACF,MAAM,QAAQ,SAAS,YAAY,KAAM,OAAO,EAChD,OAAO,MAAM,OAAO,GAAG,EAAE,KAAK,CAChC,OAAS,MAAO,CACd,QAAQ,IAAI,MAAM,CAAE,IAAK,KAAM,EAAG,gCAAgC,EAClE,OAAO,MAAM,oBAAoB,gCAAgC,CACnE,CACF,CAAC,CACH,CA9BgB","names":[],"ignoreList":[],"sources":["/Users/ck/OwaspRatRemake/backend/src/routes/ticketing.ts"],"sourcesContent":[null]}}