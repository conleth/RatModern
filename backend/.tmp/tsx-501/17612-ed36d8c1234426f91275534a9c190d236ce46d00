{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{z}from\"zod\";import{loadRallyConfig}from\"../config/rally.js\";import{getTicketingAdapter}from\"../ticketing/index.js\";const rallyTokenSchema=z.object({code:z.string()});function buildRallyAuthorizeUrl(state){const config=loadRallyConfig();const search=new URLSearchParams({response_type:\"code\",client_id:config.clientId,redirect_uri:config.redirectUri,scope:\"openid full\"});if(state){search.append(\"state\",state)}return`${config.authorizeUrl}?${search.toString()}`}__name(buildRallyAuthorizeUrl,\"buildRallyAuthorizeUrl\");async function startRallyOAuth(request,reply){const state=request.query?new URLSearchParams(request.query).get(\"state\"):void 0;const authorizeUrl=buildRallyAuthorizeUrl(state??void 0);return reply.redirect(authorizeUrl)}__name(startRallyOAuth,\"startRallyOAuth\");async function exchangeRallyCode(request,reply){const parseResult=rallyTokenSchema.safeParse(request.body);if(!parseResult.success){return reply.badRequest(\"Missing Rally authorization code.\")}const{code}=parseResult.data;const adapter=getTicketingAdapter(\"rally\");try{const tokens=await adapter.exchangeCode(code);return{accessToken:tokens.accessToken,refreshToken:tokens.refreshToken}}catch(error){request.log.error({err:error},\"Rally token exchange failed\");return reply.internalServerError(\"Failed to exchange Rally code.\")}}__name(exchangeRallyCode,\"exchangeRallyCode\");export{buildRallyAuthorizeUrl,exchangeRallyCode,startRallyOAuth};\n","warnings":[],"map":{"version":3,"mappings":"kHACA,OAAS,MAAS,MAElB,OAAS,oBAAuB,qBAChC,OAAS,wBAA2B,wBAEpC,MAAM,iBAAmB,EAAE,OAAO,CAChC,KAAM,EAAE,OAAO,CACjB,CAAC,EAEM,SAAS,uBAAuB,MAAgB,CACrD,MAAM,OAAS,gBAAgB,EAC/B,MAAM,OAAS,IAAI,gBAAgB,CACjC,cAAe,OACf,UAAW,OAAO,SAClB,aAAc,OAAO,YACrB,MAAO,aACT,CAAC,EAED,GAAI,MAAO,CACT,OAAO,OAAO,QAAS,KAAK,CAC9B,CAEA,MAAO,GAAG,OAAO,YAAY,IAAI,OAAO,SAAS,CAAC,EACpD,CAdgB,wDAgBhB,eAAsB,gBACpB,QACA,MACA,CACA,MAAM,MAAQ,QAAQ,MAClB,IAAI,gBAAgB,QAAQ,KAA+B,EAAE,IAAI,OAAO,EACxE,OAEJ,MAAM,aAAe,uBAAuB,OAAS,MAAS,EAE9D,OAAO,MAAM,SAAS,YAAY,CACpC,CAXsB,0CAatB,eAAsB,kBACpB,QACA,MACA,CACA,MAAM,YAAc,iBAAiB,UAAU,QAAQ,IAAI,EAC3D,GAAI,CAAC,YAAY,QAAS,CACxB,OAAO,MAAM,WAAW,mCAAmC,CAC7D,CAEA,KAAM,CAAE,IAAK,EAAI,YAAY,KAC7B,MAAM,QAAU,oBAAoB,OAAO,EAE3C,GAAI,CACF,MAAM,OAAS,MAAM,QAAQ,aAAa,IAAI,EAC9C,MAAO,CACL,YAAa,OAAO,YACpB,aAAc,OAAO,YACvB,CACF,OAAS,MAAO,CACd,QAAQ,IAAI,MAAM,CAAE,IAAK,KAAM,EAAG,6BAA6B,EAC/D,OAAO,MAAM,oBAAoB,gCAAgC,CACnE,CACF,CAtBsB","names":[],"ignoreList":[],"sources":["/Users/ck/OwaspRatRemake/backend/src/controllers/oauthController.ts"],"sourcesContent":[null]}}